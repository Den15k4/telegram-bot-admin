generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url = env("DATABASE_URL")
}

model User {
  id                BigInt    @id  // Изменено на BigInt для соответствия telegram user_id
  username          String?
  credits           Int       @default(0)
  created_at        DateTime  @default(now())
  last_used         DateTime?
  pending_task_id   String?
  referrer_id       BigInt?   // Изменено на BigInt
  total_referrals   Int       @default(0)
  referral_earnings Decimal   @default(0)
  payments          Payment[]
  referrer          User?     @relation("ReferralRelation", fields: [referrer_id], references: [id])
  referrals         User[]    @relation("ReferralRelation")

  @@map("users")
}

model Payment {
  id                Int       @id @default(autoincrement())
  user_id          BigInt    // Изменено на BigInt
  order_id         String?   @unique
  merchant_order_id String?   @unique
  amount           Decimal
  credits          Int
  status           String
  currency         String
  created_at       DateTime  @default(now())
  updated_at       DateTime  @default(now())
  user             User      @relation(fields: [user_id], references: [id])

  @@map("payments")
}

model AdminUser {
  id           Int       @id @default(autoincrement())
  email        String    @unique
  passwordHash String    @map("password_hash")
  role         String
  createdAt    DateTime  @default(now()) @map("created_at")
  lastLogin    DateTime? @map("last_login")

  @@map("admin_users")
}